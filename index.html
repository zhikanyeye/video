<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’äº‘æ’­ - è§†é¢‘ç®¡ç†</title>
      <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="assets/favicon-16.svg">
    <link rel="alternate icon" href="assets/favicon.svg">
    <link rel="apple-touch-icon" href="assets/favicon.svg">
    <link rel="shortcut icon" href="assets/favicon.svg">
    
    <!-- Meta Tags -->
    <meta name="description" content="é’äº‘æ’­ - ç°ä»£åŒ–äº‘ç«¯è§†é¢‘æ’­æ”¾å™¨ï¼Œæ”¯æŒå¤šæ ¼å¼æ’­æ”¾å’Œæ™ºèƒ½åˆ†äº«">
    <meta name="keywords" content="è§†é¢‘æ’­æ”¾å™¨,äº‘ç«¯åˆ†äº«,åœ¨çº¿æ’­æ”¾,é’äº‘æ’­">
    <meta name="author" content="é’äº‘æ’­å›¢é˜Ÿ">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="app-container">
        <!-- åˆ†äº«æ–¹å¼é€‰æ‹©æç¤º -->
        <div id="methodSelector" class="method-selector" style="display: none;">
            <div class="method-selector-content">
                <h3>ğŸš€ é€‰æ‹©åˆ†äº«æ–¹å¼</h3>
                <p>é€‰æ‹©æ‚¨åå¥½çš„äº‘ç«¯åˆ†äº«æ–¹æ¡ˆï¼š</p>
                <div class="method-buttons">
                    <button onclick="setShareMethod('selfhosted')" class="btn btn-primary">
                        ğŸ  è‡ªå»ºæ•°æ®åº“ (æ¨è)
                    </button>
                    <button onclick="setShareMethod('github')" class="btn btn-secondary">
                        ğŸ™ GitHub Gists
                    </button>
                </div>
                <div class="method-note">
                    <small>ğŸ’¡ å¯åœ¨è®¾ç½®ä¸­éšæ—¶æ›´æ”¹åˆ†äº«æ–¹å¼</small>
                </div>
            </div>
        </div>

        <!-- å¤´éƒ¨ -->
        <header class="header">
            <div class="header-content">                <h1 class="logo">
                    <div class="logo-container">
                        <img src="assets/favicon.svg" alt="é’äº‘æ’­" class="logo-icon">
                        <span class="logo-text">é’äº‘æ’­</span>
                    </div>
                </h1>
                <div class="header-actions">
                    <!-- åˆ†äº«æ–¹å¼çŠ¶æ€æ˜¾ç¤º -->
                    <div id="shareMethodStatus" class="share-method-status">
                        <span class="method-label">åˆ†äº«æ–¹å¼:</span>
                        <span id="currentMethod" class="method-name">æœªè®¾ç½®</span>
                        <button id="changeMethodBtn" class="btn-link">æ›´æ”¹</button>
                    </div>
                    
                    <!-- GitHubç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º -->
                    <div id="githubUserInfo" class="github-user-info" style="display: none;"></div>
                    
                    <button id="clearAllBtn" class="btn btn-danger">
                        <i class="material-icons">delete_sweep</i>
                        æ¸…ç©ºåˆ—è¡¨
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- æ·»åŠ è§†é¢‘åŒºåŸŸ -->
            <section class="add-video-section">
                <h2>
                    <i class="material-icons">add_circle</i>
                    æ·»åŠ è§†é¢‘
                </h2>
                
                <form id="addVideoForm" class="add-form">
                    <div class="form-group">
                        <label for="videoTitle">è§†é¢‘æ ‡é¢˜</label>
                        <input type="text" id="videoTitle" placeholder="è¯·è¾“å…¥è§†é¢‘æ ‡é¢˜" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="videoUrl">è§†é¢‘é“¾æ¥</label>
                        <input type="url" id="videoUrl" placeholder="è¯·è¾“å…¥è§†é¢‘é“¾æ¥ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼‰" required>
                        <div class="url-help">
                            æ”¯æŒï¼šMP4ã€M3U8ã€FLVã€RTMPç­‰æ ¼å¼
                        </div>
                    </div>
                    
                    <!-- æ‰¹é‡æ·»åŠ åŠŸèƒ½ -->
                    <div class="form-group">
                        <label for="bulkUrls">æ‰¹é‡æ·»åŠ ï¼ˆæ¯è¡Œä¸€ä¸ªé“¾æ¥ï¼‰</label>
                        <textarea 
                            id="bulkUrls" 
                            class="bulk-textarea"
                            placeholder="å¯ä»¥åœ¨è¿™é‡Œç²˜è´´å¤šä¸ªè§†é¢‘é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª&#10;ä¾‹å¦‚ï¼š&#10;https://example.com/video1.mp4&#10;https://example.com/video2.m3u8&#10;https://example.com/video3.flv"
                            rows="4"
                        ></textarea>
                        <div class="bulk-help">
                            <small>æ‰¹é‡æ·»åŠ æ—¶ï¼Œè§†é¢‘æ ‡é¢˜å°†è‡ªåŠ¨ä»é“¾æ¥ä¸­æå–</small>
                            <button type="button" id="clearBulkTextBtn" class="btn-link">æ¸…ç©º</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="videoType">è§†é¢‘ç±»å‹</label>
                        <select id="videoType">
                            <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                            <option value="mp4">MP4</option>
                            <option value="m3u8">M3U8 (HLS)</option>
                            <option value="flv">FLV</option>
                            <option value="rtmp">RTMP</option>
                        </select>
                    </div>

                    <!-- ä»åˆ†äº«é“¾æ¥å¯¼å…¥ -->
                    <div class="form-group">
                        <label for="gistUrl">ä»åˆ†äº«é“¾æ¥å¯¼å…¥</label>
                        <div class="import-group">
                            <input type="text" id="gistUrl" placeholder="ç²˜è´´åˆ†äº«é“¾æ¥æˆ–Gist ID">
                            <button type="button" id="importFromGistBtn" class="btn btn-secondary">
                                <i class="material-icons">cloud_download</i>
                                å¯¼å…¥
                            </button>
                        </div>
                        <div class="import-help">
                            <small>å¯ä»¥å¯¼å…¥å…¶ä»–äººåˆ†äº«çš„æ’­æ”¾åˆ—è¡¨</small>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="material-icons">add</i>
                            æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨
                        </button>
                        <button type="button" id="bulkAddBtn" class="btn btn-secondary">
                            <i class="material-icons">playlist_add</i>
                            æ‰¹é‡æ·»åŠ 
                        </button>
                    </div>
                </form>
            </section>

            <!-- æ’­æ”¾åˆ—è¡¨åŒºåŸŸ -->
            <section class="playlist-section">
                <div class="section-header">
                    <h2>
                        <i class="material-icons">queue_music</i>
                        æ’­æ”¾åˆ—è¡¨ (<span id="videoCount">0</span>)
                    </h2>
                    <div class="section-actions">
                        <button id="playAllBtn" class="btn btn-success">
                            <i class="material-icons">play_arrow</i>
                            æ’­æ”¾å…¨éƒ¨
                        </button>
                        <button id="shareBtn" class="btn btn-primary">
                            <i class="material-icons">share</i>
                            åˆ†äº«åˆ—è¡¨
                        </button>
                        <button id="exportBtn" class="btn btn-secondary">
                            <i class="material-icons">download</i>
                            å¯¼å‡ºåˆ—è¡¨
                        </button>
                    </div>
                </div>
                
                <div class="playlist-container">
                    <div id="emptyState" class="empty-state">
                        <i class="material-icons">video_library</i>
                        <h3>æš‚æ— è§†é¢‘</h3>
                        <p>è¯·æ·»åŠ è§†é¢‘åˆ°æ’­æ”¾åˆ—è¡¨</p>
                    </div>
                    
                    <div id="videoList" class="video-list"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- å¼¹çª— -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ç¡®è®¤æ“ä½œ</h3>
                <button id="modalClose" class="modal-close">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
            </div>
            <div class="modal-footer">
                <button id="modalCancel" class="btn btn-secondary">å–æ¶ˆ</button>
                <button id="modalConfirm" class="btn btn-primary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div id="toast" class="toast"></div>

    <!-- åˆ†äº«æ¨¡æ€æ¡† -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">åˆ†äº«æ’­æ”¾åˆ—è¡¨</h3>
                <button id="shareModalClose" class="modal-close">
                    <i class="material-icons">close</i>
                </button>
            </div>
            <div class="modal-body">
                <div class="share-content">
                    <p>æ‚¨çš„æ’­æ”¾åˆ—è¡¨å·²æˆåŠŸåˆ›å»ºåˆ†äº«é“¾æ¥ï¼</p>
                    
                    <div class="share-url-section">
                        <label for="shareUrl">åˆ†äº«é“¾æ¥</label>
                        <div class="url-input-group">
                            <input type="text" id="shareUrl" readonly />
                            <button id="copyUrlBtn" class="btn btn-primary">
                                <i class="material-icons">content_copy</i>
                                å¤åˆ¶
                            </button>
                        </div>
                    </div>
                    
                    <div class="share-qr-section">
                        <label>äºŒç»´ç åˆ†äº«</label>
                        <div class="qr-container">
                            <img id="shareQR" alt="åˆ†äº«äºŒç»´ç " />
                        </div>
                        <p class="qr-hint">æ‰«æäºŒç»´ç å¿«é€Ÿåˆ†äº«ç»™å¥½å‹</p>
                    </div>
                    
                    <div class="share-tips">
                        <h4>ä½¿ç”¨è¯´æ˜ï¼š</h4>
                        <ul>
                            <li>åˆ†äº«é“¾æ¥æ°¸ä¹…æœ‰æ•ˆï¼Œå¯ä»¥éšæ—¶è®¿é—®</li>
                            <li>æ¥æ”¶è€…æ‰“å¼€é“¾æ¥å³å¯ç›´æ¥æ’­æ”¾è§†é¢‘</li>
                            <li>è§†é¢‘æ•°æ®å­˜å‚¨åœ¨GitHub Gistsä¸­</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ ¸å¿ƒè„šæœ¬æ–‡ä»¶ -->    <script src="scripts/github-auth.js"></script>
    <script src="scripts/improved-gist-manager.js"></script>
    <script src="scripts/main.js"></script>
    
    <script>
        // åˆå§‹åŒ–åˆ†äº«æ–¹å¼é€‰æ‹©
        document.addEventListener('DOMContentLoaded', function() {
            initializeShareMethod();
        });
        
        // æ ¹æ®URLå‚æ•°è®¾ç½®åˆ†äº«æ–¹å¼
        function initializeShareMethod() {
            const urlParams = new URLSearchParams(window.location.search);
            const method = urlParams.get('method');
            
            if (method) {
                setShareMethod(method);
            } else {
                // æ£€æŸ¥æ˜¯å¦å·²æœ‰è®¾ç½®
                const savedMethod = localStorage.getItem('shareMethod');
                if (savedMethod) {
                    setShareMethod(savedMethod);
                } else {
                    // æ˜¾ç¤ºé€‰æ‹©ç•Œé¢
                    showMethodSelector();
                }
            }
        }
        
        // æ˜¾ç¤ºåˆ†äº«æ–¹å¼é€‰æ‹©å™¨
        function showMethodSelector() {
            document.getElementById('methodSelector').style.display = 'flex';
        }
        
        // è®¾ç½®åˆ†äº«æ–¹å¼
        function setShareMethod(method) {
            localStorage.setItem('shareMethod', method);
            document.getElementById('methodSelector').style.display = 'none';
            
            // æ›´æ–°UIæ˜¾ç¤º
            updateMethodStatus(method);
            
            // æ ¹æ®æ–¹å¼åˆå§‹åŒ–ç›¸åº”çš„ç®¡ç†å™¨
            if (method === 'github') {
                initializeGitHubMethod();
            } else if (method === 'selfhosted') {
                initializeSelfHostedMethod();
            }
        }
        
        // æ›´æ–°æ–¹å¼çŠ¶æ€æ˜¾ç¤º
        function updateMethodStatus(method) {
            const methodNames = {
                'github': 'ğŸ™ GitHub Gists',
                'selfhosted': 'ğŸ  è‡ªå»ºæ•°æ®åº“'
            };
            
            document.getElementById('currentMethod').textContent = methodNames[method] || 'æœªè®¾ç½®';
        }
          // åˆå§‹åŒ–GitHubæ–¹å¼
        function initializeGitHubMethod() {
            const userInfoDiv = document.getElementById('githubUserInfo');
            userInfoDiv.style.display = 'block';
            
            if (gitHubAuth.isAuthenticated()) {
                // æ˜¾ç¤ºæˆæƒçŠ¶æ€
                gitHubAuth.showAuthStatus();
            } else {
                userInfoDiv.innerHTML = `
                    <div class="auth-prompt">
                        <span>GitHubæœªæˆæƒ</span>
                        <button onclick="gitHubAuth.showAuthGuide()" class="btn btn-primary btn-sm">
                            æˆæƒç™»å½•
                        </button>
                    </div>
                `;
            }
        }
        
        // åˆå§‹åŒ–è‡ªå»ºåç«¯æ–¹å¼
        function initializeSelfHostedMethod() {
            document.getElementById('githubUserInfo').style.display = 'none';
            
            // æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯ç”¨
            checkBackendStatus();
        }
        
        // æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
        async function checkBackendStatus() {
            try {
                const response = await fetch('http://localhost:8090/api/health');
                if (response.ok) {
                    console.log('åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ');
                } else {
                    showBackendWarning();
                }
            } catch (error) {
                showBackendWarning();
            }
        }
        
        // æ˜¾ç¤ºåç«¯æœåŠ¡è­¦å‘Š
        function showBackendWarning() {
            const warning = document.createElement('div');
            warning.className = 'backend-warning';
            warning.innerHTML = `
                <div class="warning-content">
                    <i class="material-icons">warning</i>
                    <span>åç«¯æœåŠ¡æœªå¯åŠ¨ï¼Œè¯·å…ˆè¿è¡ŒæœåŠ¡å™¨</span>
                    <button onclick="this.parentNode.parentNode.remove()" class="btn-close">Ã—</button>
                </div>
            `;
            document.body.appendChild(warning);
        }
        
        // æ›´æ”¹åˆ†äº«æ–¹å¼
        document.getElementById('changeMethodBtn').addEventListener('click', function() {
            showMethodSelector();
        });
    </script>
</body>
</html>
